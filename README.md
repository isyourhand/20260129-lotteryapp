# Lottery App - 3D 抽奖系统

一个基于 React + Electron + TypeScript 开发的桌面端 3D 抽奖应用，支持 Excel 导入参会人员、多奖池管理、3D 球体动画效果和获奖结果导出。

## 功能特性

### 核心功能
- **Excel 导入**: 支持从 Excel 文件导入参会人员名单
- **多奖池管理**: 支持配置多个奖池，每个奖池独立设置奖品和数量
- **3D 球体动画**: 参会人员卡片以 3D 球体形式展示，支持旋转动画
- **智能抽取**: 支持一次抽取多人，自动分配具体奖品
- **结果导出**: 中奖结果可导出为 Excel 文件
- **历史记录**: 自动保存抽奖历史，支持重新抽奖

### 视觉效果
- **3D 球体渲染**: 基于 CSS3 3D 变换实现球体效果
- **物理引擎**: 自定义物理引擎控制球体旋转（加速、减速、停止）
- **翻转卡片**: 中奖结果以翻转卡片形式展示
- **一等奖特效**: 一等奖中奖卡片带有红色流动光芒特效
- **扁平化设计**: 侧边栏、弹窗等采用扁平化设计风格

### 技术栈
- **前端框架**: React 19 + TypeScript
- **桌面端**: Electron 39
- **构建工具**: Vite 7
- **样式**: CSS3 + CSS Variables
- **Excel 处理**: SheetJS (xlsx)
- **动画**: CSS3 Animations + canvas-confetti

## 项目结构

```
lottery-app/
├── electron/                 # Electron 主进程
│   └── main.ts              # 主进程入口
├── src/
│   ├── components/          # React 组件
│   │   ├── App.tsx         # 主应用组件
│   │   ├── LotteryPanel.tsx    # 3D 抽奖面板
│   │   ├── Sidebar.tsx     # 侧边栏（奖池选择）
│   │   ├── WinnerModal.tsx # 中奖结果弹窗
│   │   ├── UploadLayer.tsx # Excel 上传层
│   │   ├── ControlBar.tsx  # 控制栏
│   │   └── PrizeHeader.tsx # 奖品标题
│   ├── hooks/              # 自定义 Hooks
│   │   ├── useLottery.ts   # 抽奖逻辑
│   │   └── useSpherePhysics.ts # 球体物理引擎
│   ├── services/           # 服务层
│   │   ├── lottery.ts      # 抽奖算法
│   │   ├── physicsUtils.ts # 物理工具函数
│   │   └── xlsx.ts         # Excel 处理
│   ├── config/
│   │   └── prizes.ts       # 奖池配置
│   ├── styles/             # 样式文件
│   │   ├── base.css        # 基础样式
│   │   ├── main.css        # 主样式
│   │   ├── sidebar.css     # 侧边栏样式
│   │   ├── lottery-panel.css   # 抽奖面板样式
│   │   ├── winner-modal.css    # 中奖弹窗样式
│   │   └── control-bar.css # 控制栏样式
│   ├── types/
│   │   └── index.ts        # TypeScript 类型定义
│   └── main.tsx            # 渲染进程入口
├── dist/                   # 构建输出
├── dist-electron/          # Electron 构建输出
└── package.json
```

## 核心模块说明

### 1. 3D 球体系统 (LotteryPanel)
- 使用 CSS3 `transform-style: preserve-3d` 实现 3D 效果
- 基于黄金角算法均匀分布卡片在球体表面
- 支持鼠标滚轮缩放球体

### 2. 物理引擎 (useSpherePhysics)
- 模拟真实物理效果：加速、摩擦减速、停止
- 使用 `requestAnimationFrame` 实现流畅动画
- 支持随机停止角度，增加不确定性

### 3. 奖池系统 (Sidebar + prizes.ts)
- 支持配置多类型奖池（一等奖、二等奖、红包、盲盒等）
- 每个奖池可设置独立奖品列表和数量
- 实时显示剩余奖品数量
- 支持多奖品奖池（如盲盒）随机分配

### 4. 智能布局算法 (WinnerModal)
- 根据中奖人数自动计算最佳卡片布局
- 自适应视口大小，确保卡片比例和可读性
- 单列到多列自动切换，保持视觉平衡

## 配置说明

### 奖池配置 (src/config/prizes.ts)
```typescript
export const PRIZE_POOLS: PrizePool[] = [
  {
    id: "first",
    name: "一等奖",
    items: ["HUAWEI平板"],
    drawnCount: 0,
    isFirstPrize: true,  // 启用一等奖特效
  },
  // ... 其他奖池
];
```

### 当前奖池列表

| 奖池       | 奖品                  | 数量 |
| :--------- | :-------------------- | :--- |
| 一等奖     | HUAWEI平板            | 1    |
| 二等奖     | 小米手表              | 2    |
| 三等奖     | 小米手环              | 5    |
| 阳光普照奖 | 一日带薪假            | 5    |
| 红包-1     | 奋斗者红包188元       | 11   |
| 红包-2     | 大吉大利奖666元       | 8    |
| 红包-3     | 十周年锦鲤888元       | 5    |
| 红包-4     | 88元现金红包          | 7    |
| 盲盒       | 全家桶洗护套装        | 2    |
| 盲盒       | 马上有福玩偶          | 1    |
| 盲盒       | 马上有钱玩偶          | 1    |
| 盲盒       | 美的养生壶            | 2    |
| 盲盒       | 九阳破壁机            | 1    |
| 盲盒       | 小米吹风机            | 1    |
| 盲盒       | 小米充电宝            | 1    |
| 盲盒       | 工位护腰靠枕          | 1    |
| 盲盒       | 发热鼠标垫            | 1    |
| 盲盒       | 户外露营桌椅折叠      | 1    |
| 盲盒       | 苏泊尔电烤箱          | 1    |
| 盲盒       | 户外帐篷              | 1    |
| 盲盒       | 砂锅                  | 1    |
| 盲盒       | 小米体脂秤            | 1    |
| 盲盒       | 颈部按摩枕            | 2    |
| 盲盒       | 蓝牙自拍杆            | 1    |
| 盲盒       | 马年公仔              | 1    |
| 幸运礼     | 刮刮乐&彩票（幸运奖） | 2    |

### Excel 导入格式
Excel 文件需包含以下列：
- `姓名`: 参会人员姓名
- `部门`: 所属部门（可选）

## 开发命令

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建应用
npm run build

# 预览构建
npm run preview
```

## 使用流程

1. **导入名单**: 上传包含参会人员信息的 Excel 文件
2. **选择奖池**: 从侧边栏选择要抽取的奖池
3. **设置数量**: 调整本次抽取的人数
4. **开始抽奖**: 点击"开始抽奖"按钮，3D 球体开始旋转
5. **查看结果**: 球体停止后，中奖卡片飞出并翻转显示结果
6. **导出结果**: 可随时导出中奖名单到 Excel

## 技术亮点

### 1. 性能优化
- 使用 `will-change` 优化动画性能
- 卡片使用 `useMemo` 避免重复渲染
- 3D 变换使用 GPU 加速

### 2. 响应式设计
- 弹窗尺寸根据视口和中奖人数自适应
- 侧边栏固定高度，内容区域可滚动
- 卡片大小随人数自动调整，保证可读性

### 3. 可访问性
- 支持键盘操作
- 清晰的视觉反馈（选中态、禁用态）
- 动画过渡平滑，避免闪烁

## 浏览器/平台支持

- **桌面端**: Windows, macOS, Linux (通过 Electron)
- **Web 端**: Chrome, Firefox, Safari, Edge (现代浏览器)

## 注意事项

1. Excel 导入的文件格式需为 `.xlsx`
2. 一等奖中奖卡片会有特殊红色特效
3. 抽奖过程中请勿刷新页面，以免丢失进度
4. 历史记录保存在浏览器 localStorage 中

## 未来扩展

- [ ] 支持自定义背景和主题色
- [ ] 增加音效支持
- [ ] 支持多轮抽奖自动切换
- [ ] 添加中奖者去重验证
- [ ] 支持导出 PDF 中奖证书
